#!/bin/sh
WPA_SUPPLICANT_CONF=/tmp/wpa_supplicant.conf
WIFI_MODULE=rt5370sta

prepare_conf()
{
    cat > $WPA_SUPPLICANT_CONF << --EOF--
# This file is automatically generated by the $0
ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=root

eapol_version=1
ap_scan=$1
fast_reauth=1

network={
scan_ssid=0
ssid=""
}
--EOF--
}

run_supplicant() {
    prepare_conf 2
}


case "$1" in
    start)
        $0 status && $0 stop
        modprobe $WIFI_MODULE 
        run_supplicant
        ;;
    stop)
        modprobe -r $WIFI_MODULE
        ;;
    restart)
        $0 stop
        $0 start
        ;;
    *)
        echo "Usage: $0 [start|stop|restart]"
        ;;
esac
